<div class="container">
  <h2>Employee Work Details</h2>

  <div class="card">
    <app-filter [filters]="filters" (filterChanged)="onFilterChanged($event)"
      (triggerParentFunction)="fetchPayRecordsbyComp()">
    </app-filter>
    <button style="width:77px" class="btn btn-primary" (click)="search()">Search</button>
  </div>

  <div class="container mt-4">
    <h3>Vendor Payment Details:
      {{this.filters.selectedMonth.value | monthName }} {{this.filters.selectedYear.value}}
    </h3>
    <table class="table table-striped table-bordered">
      <thead>
        <tr>
          <th scope="col">Action</th>
          <th scope="col">Name</th>
          <th scope="col">Total Payable Salary</th>
          <th scope="col">GST</th>
          <th scope="col">Service Charge</th>
          <th scope="col">TDS</th>

          <th scope="col">EPF</th>
          <th scope="col">ESI</th>

          <th scope="col">Net Amount</th>

        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let vendor of companyVendors">
          <td>
            <div class="d-flex flex-wrap gap-2">
              <button *ngIf="userAccessLevel == UserType.STATE_ADMIN && vendor.invoiceGenerated" class="btn btn-primary"
                (click)="openVendorModal('UPDATE', vendor)">
                Update Payment
              </button>
              <button *ngIf="userAccessLevel == UserType.VENDOR && vendor.invoiceGenerated" class="btn btn-primary"
                (click)="openVendorModal('VIEW', vendor)">
                View Payment
              </button>
              <button *ngIf="userAccessLevel == UserType.STATE_ADMIN && vendor.invoiceGenerated" class="btn btn-primary"
                (click)="openEmployeePaymentModal('VIEW', vendor)">
                VIEW Employee Payment
              </button>
              <button *ngIf="userAccessLevel == UserType.VENDOR && vendor.invoiceGenerated" class="btn btn-primary"
                (click)="openEmployeePaymentModal('UPDATE', vendor)">
                Update Employee Payment
              </button>
              <button *ngIf="!vendor.invoiceGenerated && userAccessLevel == UserType.VENDOR" class="btn btn-primary"
                (click)="navigateVendorInvoice(vendor, 'GENERATE')">
                Generate Invoice
              </button>
              <button *ngIf="vendor.invoiceGenerated" class="btn btn-primary"
                (click)="navigateVendorInvoice(vendor, 'VIEW')">
                View Invoice
              </button>
              <p [ngClass]="{
                'invoice-generated': vendor.invoiceGenerated,
                'invoice-not-generated': !vendor.invoiceGenerated
            }" class="invoice-label">
              {{ vendor.invoiceGenerated ? 'Invoice Generated' : 'Invoice Not Generated' }}
          </p>
            
            </div>
          </td>
          <td>{{ vendor.vendorName }}</td>
          <td>{{ vendor.totalPayableAmount | currency:'INR' }}</td>
          <td>{{ vendor.gst | currency:'INR' }}</td>
          <td>{{ vendor.serviceCharge | currency:'INR' }}</td>
          <td>{{ vendor.tds | currency:'INR' }}</td>

          <td>{{ vendor.epf | currency:'INR' }}</td>
          <td>{{ vendor.esi | currency:'INR' }}</td>

          <td>{{ vendor.netAmount | currency:'INR' }}</td>
        </tr>
      </tbody>
    </table>
  </div>

  <app-common-dialog [showDialog]="isVendorModalOpen" [showCloseIcon]="true" [dialogTitle]="vendorPayment.title"
    (closeDialog)="isVendorModalOpen = false" [showSubmitButton]="true" (submitDialog)="updateVendorModal()"
    [maxWidth]="'900px'">

    <div class="row">
      <div class="col-md-6">
        <label for="totalPayableAmount">Total Payable Salary:</label>
        <input [disabled]="true" type="number" class="form-control" id="totalPayableAmount"
          [(ngModel)]="selectedVendor.totalPayableAmount">
      </div>
      <div class="col-md-6">
        <label for="gst">GST:</label>
        <input [disabled]="true" type="number" class="form-control" id="gst" [(ngModel)]="selectedVendor.gst">
      </div>
    </div>

    <div class="row">
      <div class="col-md-6">
        <label for="serviceCharge">Service Charge:</label>
        <input [disabled]="true" type="number" class="form-control" id="serviceCharge"
          [(ngModel)]="selectedVendor.serviceCharge">
      </div>
      <div class="col-md-6">
        <label for="tds">TDS:</label>
        <input [disabled]="true" type="number" class="form-control" id="tds" [(ngModel)]="selectedVendor.tds">
      </div>
    </div>

    <div class="row">
      <div class="col-md-6">
        <label for="netAmount">Net Amount:</label>
        <input [disabled]="true" type="number" class="form-control" id="netAmount"
          [(ngModel)]="selectedVendor.netAmount">
      </div>
    </div>

    <div class="row">
      <div class="col-md-6">
        <label for="paymentStatus">Payment Status:</label>
        <select [disabled]="vendorPayment.submit_disabled" class="form-control" id="paymentStatus"
          [(ngModel)]="selectedVendor.paymentStatus">
          <option value="PAID">Paid</option>
        </select>
      </div>

      <!--remarks-->
      <div class="col-md-6">
        <label for="remarks">Remarks:</label>
        <input [disabled]="vendorPayment.submit_disabled" type="text" class="form-control" id="remarks"
          [(ngModel)]="selectedVendor.remarks">
      </div>
    </div>

    <br>
    <div *ngIf="selectedVendor.paymentStatus === 'PAID'" class="row">
      <h4>Cheque Details</h4>
      <div class="col-md-6">
        <label>Cheque Number:</label>
        <input [disabled]="vendorPayment.submit_disabled" type="text" class="form-control" id="chequeNumber"
          [(ngModel)]="selectedVendor.chequeNumber">
      </div>

      <div class="col-md-6">
        <label>Cheque Date:</label>
        <input [disabled]="vendorPayment.submit_disabled" type="date" class="form-control" id="chequeDate"
          [(ngModel)]="selectedVendor.chequeDate">
      </div>

      <div class="col-md-6">
        <label>Cheque Amount:</label>
        <input [disabled]="vendorPayment.submit_disabled" type="text" class="form-control" id="chequeAmount"
          [(ngModel)]="selectedVendor.chequeAmount">
      </div>

      <div class="col-md-6">
        <label>Bank Name:</label>
        <input [disabled]="vendorPayment.submit_disabled" type="text" class="form-control" id="bankName"
          [(ngModel)]="selectedVendor.bankName">
      </div>
    </div>
    <br>

  </app-common-dialog>


  <app-common-dialog [showDialog]="isEmployeePaymentModelOpen" [showCloseIcon]="true"
    [dialogTitle]="employeePayment.title" (closeDialog)="isEmployeePaymentModelOpen = false" [showSubmitButton]="true"
    (submitDialog)="updateEmployeePayment()" [maxWidth]="'900px'">
    <!-- File Upload -->
    <div class="row">
      <h4>Employee Payments By Vendor</h4>
      <div class="col-md-12">
        <p *ngIf="selectedVendor.employeePaid==0"> Not Paid To Employee Yet.</p>
        <p *ngIf="selectedVendor.employeePaid==1">Paid To Employee Yet.</p>
      </div>
    </div>

    <div class="row">
      <button [style.width]="'220px'" class="btn btn-primary" (click)="downloadEmployeePaymentForm()">Download Employee
        Payment Form</button>
      <div *ngIf="userAccessLevel == UserType.VENDOR" class="col-md-12">
        <label for="fileUpload">Employee Payments File uploaded by Vendor:</label>
        <input type="file" class="form-control" id="fileUpload" (change)="onFileSelected($event)" accept=".xlsx">
      </div>
    </div>

  </app-common-dialog>

</div>