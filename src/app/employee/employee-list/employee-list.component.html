<div class="cards-filter">
  <app-filter [filters]="filters" (filterChanged)="onFilterChanged($event)" (triggerParentFunction)="getEmployeeList()">
  </app-filter>
  <button *ngIf="false" style="width:77px" class="btn btn-primary" (click)="search()">Search</button>
</div>

<button *ngIf="false" class="btn btn-success mb-3" type="button" (click)="openModal(Action.CREATE)">
  Add Employee
</button>

<h3>Employee List</h3>
<div style="overflow-y: auto; max-height: 700px;" class="Employee-list-container">

  <table style="white-space: break-spaces !important;" id="emp-table" class="table table-bordered">
    <thead>
      <tr>
        <th [rowSpan]="2">#</th>
        <th [colSpan]="7" style="text-align: center;">Personal Info</th>
        <th [colSpan]="3" style="text-align: center;">Qualification</th>
        <th [colSpan]="2" style="text-align: center;">Experience</th>
        <th [rowSpan]="2">Aadhaar</th>
        <th [rowSpan]="2">Bank Details</th>
        <th [rowSpan]="2">Total Wages</th>
      </tr>
      <tr>
       
        <th>Employee Name</th>
        <th>Employee Code</th>

        <th>Contact Number</th>

        <th *ngIf="userAccessLevel  == UserType.STATE_ADMIN || userAccessLevel  == UserType.VENDOR">
          Unit Name
        </th>
        <th *ngIf="userAccessLevel  == UserType.STATE_ADMIN || userAccessLevel  == UserType.MANAGER">
          Vendor
        </th>

        <th>Department Name</th>
        <th>Designation Name</th>

        <th>Employment Type</th>
        <th>Required</th>
        <th>Actual</th>
        <th>Upload</th>
        <th>Required</th>
        <th>Actual</th>              
      
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let employee of Employees; let i = index">
        <td>
          {{ ((pageAttributes.currentPage - 1) * pageAttributes.pageSize) + (i + 1) }}
          <button class="btn btn-primary" type="button" (click)="openModal(Action.UPDATE, employee)">
            Edit
          </button>
          <button class="btn btn-danger" type="button" (click)="openModal(Action.VIEW, employee)">
            View
          </button>
        </td>
        <td>{{ employee.employeeName }}</td>
        <td>{{ employee.employeeCode }}</td>


        <td>{{ employee.contactNo }}</td>

        <td *ngIf="userAccessLevel  == UserType.STATE_ADMIN || userAccessLevel  == UserType.VENDOR">
          {{ employee.companyFName }}
        </td>
        <td *ngIf="userAccessLevel  == UserType.STATE_ADMIN || userAccessLevel  == UserType.MANAGER">
          {{ employee.vendorName }}
        </td>

        <td>{{ employee.departmentFName }}</td>
        <td>{{ employee.designationName }}</td>


        <td>{{ employee.employementType }}</td>

        <td>
          {{employee.formattedQualifications}}
        </td>
        <td [style]="{ backgroundColor: employee.notMatchedQualification ? '#ffa19c' : ''}">
          <span>
            {{ employee.degreeName != '' ? employee.degreeName : 'NA' }} 
          </span>                   
        </td>
        <td>
          <button class="btn btn-primary" type="button" data-bs-toggle="modal" data-bs-target="#exampleModal"
            (click)="show_Certificate(employee, ModuleType.EDUCATION_CERT)">
            <i class="fas fa-file-alt"></i>
          </button>
        </td>
        <td>
          {{employee.formattedQualifications}}
        </td>
        <td>
          <span >
            {{ employee.experience }} Years
          </span>
        </td>


        <td>{{ employee.aadhaarNumber }}
          <button type="button" class="btn btn-primary" (click)="show_Certificate(employee, ModuleType.ADHAR)">
            <i class="fas fa-eye"></i>
          </button>
        </td>


        <!--Update Bank Details Action-->
        <td>
          <button class="btn btn-primary" type="button" (click)="openBankModal(employee.employeeId)">
            <i class="fas fa-university"></i>
          </button>
        </td>

        <!-- Total Wages Column (Editable) -->
        <td>
          <ng-container *ngIf="employee.isEditing">
            <input type="number" [(ngModel)]="employee.totalWages" class="form-control" />
            <button class="btn btn-success btn-sm" (click)="updateTotalWages(employee)">
              <i class="fas fa-save"></i> <!-- Save Icon -->
            </button>
            <button class="btn btn-danger btn-sm" (click)="cancelEdit(employee)">
              <i class="fas fa-times"></i> <!-- Close Icon -->
            </button>
          </ng-container>
          <ng-container *ngIf="!employee.isEditing">
            {{ employee.totalWages | currency: 'INR' }}
            <button class="btn btn-warning btn-sm" (click)="toggleEditWages(employee)">
              <i class="fas fa-edit"></i> <!-- Edit Icon -->
            </button>
          </ng-container>
        </td>

      </tr>
    </tbody>
  </table>
</div>
<app-server-pagination  [pageAttributes]="pageAttributes" 
(triggerParentFunction)="getEmployeeList()">
</app-server-pagination>



<app-common-dialog [showDialog]="modal.show && modal.module == ModuleType.EMPLOYEE" [dialogTitle]="modal.title"
  [showCloseIcon]="true" [showSubmitButton]="modal.action==Action.UPDATE" (submitDialog)="saveEmployee()"
  (closeDialog)="closeModal()">

  <div class="container mt-4">
    <!-- Card 1: Personal Details -->

    <div>
      <label>
        Active:
      </label>
      <label class="switch">
        
        <input type="checkbox" [checked]="modal.employee.recordStatus == 1" (change)="toggleRecordStatus(modal.employee)">
        <span class="slider round"></span>
      </label>
      
      
      
    </div>
    <div class="card mb-3">
      <div class="card-header bg-secondary text-white">
        Personal Details
      </div>
      <div class="card-body">
        <div class="mb-3">
          <label for="employeeName" class="form-label">Employee Name</label>
          <input type="text" class="form-control" [(ngModel)]="modal.employee.employeeName" id="employeeName"
            name="employeeName" placeholder="Enter Employee Name" required [disabled]="modal.action === 'VIEW'">
        </div>
        <div class="mb-3">
          <label for="EmployeeCode" class="form-label">Employee Code</label>
          <input type="text" class="form-control" id="EmployeeCode" [(ngModel)]="modal.employee.employeeCode"
            name="EmployeeCode" placeholder="Enter Employee Code" required [disabled]="true">
        </div>


        <!-- Gender -->
        <div class="mb-3">
          <label for="Gender" class="form-label">Gender</label>
          <select class="form-select" id="Gender" [(ngModel)]="modal.employee.gender" name="Gender" required
            [disabled]="modal.action === 'VIEW'">
            <option value="">Select Gender</option>
            <option value="Male">Male</option>
            <option value="Female">Female</option>
          </select>
        </div>

        <div class="mb-3">
          <label for="dob" class="form-label">Date Of Birth</label>
          <input type="date" class="form-control" id="dob" [(ngModel)]="modal.employee.dob" name="dob"
            placeholder="Enter Date Of Birth" [disabled]="modal.action === 'VIEW'">
        </div>

        <!-- Aadhaar Number -->
        <div class="mb-3">
          <label for="AadhaarNumber" class="form-label">Aadhar Number</label>
          <input type="text" class="form-control" id="AadhaarNumber" [(ngModel)]="modal.employee.aadhaarNumber"
            name="AadhaarNumber" placeholder="Enter AadhaarNumber" [disabled]="modal.action === 'VIEW'">
        </div>

      </div>
    </div>

    <!-- Card 2: Contact Details -->
    <div class="card mb-3">
      <div class="card-header bg-secondary text-white">
        Employee Details
      </div>
      <div class="card-body">
        <form>

          <!-- Employment Type -->
          <div class="mb-3">
            <label for="employementType" class="form-label">Employement Type</label>
            <select class="form-select" id="employementType" [(ngModel)]="modal.employee.employementType"
              name="employementType" required [disabled]="modal.action === 'VIEW'">
              <option value="">Select Type</option>
              <option value="Permanent">Permanent</option>
              <option value="Contract">Contract</option>
              <option value="Outsourced">Outsourced </option>
            </select>
          </div>

          <!-- Date of Joining -->
          <div class="mb-3">
            <label for="doj" class="form-label">Date OF Joining</label>
            <input type="date" class="form-control" id="doj" [(ngModel)]="modal.employee.doj" name="doj"
              placeholder="Enter Date OF Joining" [disabled]="modal.action === 'VIEW'">
          </div>


          <!-- City Name -->
          <div class="mb-3">
            <label for="City" class="form-label">City Name</label>

            <input *ngIf="modal.action === Action.VIEW" type="text" class="form-control disabled-bg" id="City"
              [(ngModel)]="modal.employee.cityName" name="City" />
            <select *ngIf="modal.action === Action.UPDATE || modal.action === Action.CREATE" (change)="onCityChange()"
              class="form-select" id="City" [(ngModel)]="modal.employee.cityId" name="cityId">
              <option value="">Select City</option>
              <option *ngFor="let city of dropdowns.cities" [value]="city.cityId">{{ city.cityName }}</option>
            </select>
          </div>

          <!-- Company Name -->
          <div class="mb-3">
            <label for="CompanyId" class="form-label">Unit Name</label>
            <input [disabled]="true" *ngIf="modal.action === Action.VIEW" type="text" class="form-control disabled-bg"
              id="City" [(ngModel)]="modal.employee.companyFName" />
            <select *ngIf="modal.action === Action.UPDATE || modal.action === Action.CREATE"
              (change)="onCompanyChange()" class="form-select" id="CompanyId" [(ngModel)]="modal.employee.companyId"
              name="companyId">
              <option value="">Select Unit</option>
              <option *ngFor="let company of dropdowns.companies" [value]="company.companyId">{{ company.companyFName }}
              </option>
            </select>
          </div>

          <!-- Vendor -->
          <div class="mb-3">
            <label for="vendorId" class="form-label">Vendor</label>
            <input [disabled]="true" *ngIf="modal.action === Action.VIEW" type="text" class="form-control disabled-bg"
              id="City" [(ngModel)]="modal.employee.vendorName" />
            <select *ngIf="modal.action === Action.UPDATE || modal.action === Action.CREATE" class="form-select"
              id="vendorId" [(ngModel)]="modal.employee.vendorId" name="vendorId">
              <option value="">Select Vendor</option>
              <option *ngFor="let vendor of dropdowns.vendors" [value]="vendor.vendorId">{{ vendor.vendorName }}
              </option>
            </select>
          </div>


          <!-- Department Name -->
          <div class="mb-3">
            <label for="DepartmentId" class="form-label">Department Name</label>
            <input [disabled]="true" *ngIf="modal.action === Action.VIEW" type="text" class="form-control disabled-bg"
              id="City" [(ngModel)]="modal.employee.departmentFName" />
            <select *ngIf="modal.action === Action.UPDATE || modal.action === Action.CREATE"
              (change)="onDepartmentChange()" class="form-select" id="DesignationId"
              [(ngModel)]="modal.employee.departmentId" name="departmentId">
              <option value="">Select Department</option>
              <option *ngFor="let department of dropdowns.departments" [value]="department.departmentId">{{
                department.departmentFName }}</option>
            </select>
          </div>

          <!-- Designation Name -->
          <div class="mb-3">
            <label for="DesignationId" class="form-label">Designation Name</label>
            <input [disabled]="true" *ngIf="modal.action === Action.VIEW" type="text" class="form-control disabled-bg"
              id="City" [(ngModel)]="modal.employee.designationName" />

            <select *ngIf="modal.action === Action.UPDATE || modal.action === Action.CREATE" class="form-select"
              id="DesignationId" [(ngModel)]="modal.employee.designationId" name="designationId">
              <option value="">Select Designation</option>
              <option *ngFor="let designation of dropdowns.designation" [value]="designation.designationId">{{
                designation.designationName }}</option>
            </select>
          </div>


          <!-- Passed Out Year -->
          <div class="mb-3">
            <label for="passedOutYear" class="form-label">Passed Out Year</label>
            <input type="number" class="form-control" id="passedOutYear" [(ngModel)]="modal.employee.passedOutYear"
              name="passedOutYear" placeholder="Enter passed Out Year" [disabled]="modal.action === 'VIEW'">
          </div>
          <!-- Qualifications -->
          <div class="mb-3">
            <label for="Qualifications" class="form-label">Qualifications</label>

            <select class="form-select" id="Qualifications" [(ngModel)]="modal.employee.degreeId" name="Qualifications">
              <option value="">Select Qualification</option>
              <option *ngFor="let degree of dropdowns.degree" [value]="degree.degree_Id">
                {{ degree.degree_Name }}
              </option>
            </select>
          </div>

          <!-- Experience -->
          <div class="mb-3">
            <label for="experience" class="form-label">Experience(years)</label>
            <input type="number" class="form-control" id="experience" [(ngModel)]="modal.employee.experience"
              name="experience" placeholder="Enter experience" [disabled]="modal.action === 'VIEW'">
          </div>
        </form>
      </div>
    </div>

    <!-- Card 3: Contact Details -->
    <div class="card mb-3">
      <div class="card-header bg-secondary text-white">
        Contact Details
      </div>
      <div class="card-body">
        <form>
          <!-- Contact Number -->
          <div class="mb-3">
            <label for="contactNo" class="form-label">Contact Number</label>
            <input type="text" class="form-control" id="contactNo" [(ngModel)]="modal.employee.contactNo"
              name="contactNo" placeholder="Enter Contact Number" [disabled]="modal.action === 'VIEW'">
          </div>

        </form>
      </div>
    </div>

    <!-- Card 4: Certificate Details -->
    <div class="card mb-3">
      <div class="card-header bg-secondary text-white">
        Certificate Details
      </div>
      <div class="card-body">
        <form>
          <div class="mb-3">
            <label>Education Certificate</label>
            <div class="form-control">
              <button type="button" class="btn btn-primary"
                (click)="show_Certificate(modal.employee, ModuleType.EDUCATION_CERT)">View/Update</button>

            </div>
          </div>

          <div class="mb-3">
            <label>Adhar</label>
            <div class="form-control">
              <button type="button" class="btn btn-primary"
                (click)="show_Certificate(modal.employee, ModuleType.ADHAR)">View/Update</button>
            </div>
          </div>
        </form>
      </div>
    </div>

  </div>


</app-common-dialog>


<!-- Certificate Modal -->
<app-common-dialog [showDialog]="modal.show && modal.module != ModuleType.EMPLOYEE " [dialogTitle]="modal.title "
  [showCloseIcon]="true" [showSubmitButton]="true" (submitDialog)="uploadCertificate()" (closeDialog)="closeModal()">

  <div class="mb-3">
    <label for="certificateImage" class="form-label">Upload Certificate</label>
    <input type="file" class="form-control" id="certificateImage" (change)="educationCertificateImage($event)" multiple>

  </div>

  <table class="table table-bordered">
    <thead>
      <tr>
        <th>#</th>
        <th>Document Type</th>
        <th>File</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let obj of educertificateimage; let i = index">
        <td>
          <span>{{ i + 1 }}</span>

        </td>
        <td>{{ obj.docType }}</td>
        <td>
          <span>
            <a href="{{ obj.certificateImage }}" target="_blank">View</a>
            <i class="fa fa-trash" (click)="deleteEmpDoc(obj)"></i>
          </span>
        </td>

      </tr>
    </tbody>
  </table>

</app-common-dialog>


<!-- Bank Details Modal -->
<app-common-dialog [showDialog]="bankModal.show" [dialogTitle]="bankModal.title" [showCloseIcon]="true"
  [showSubmitButton]="true" (submitDialog)="submitBankDetails()" (closeDialog)="closeBankModal()">

  <div class="mb-3">
    <label for="bankName" class="form-label">Bank Name</label>
    <input type="text" class="form-control disabled-bg" id="bankName" [(ngModel)]="bankModal.bankDetails.bankName"
      name="bankName" placeholder="Enter Bank Name" [disabled]="modal.action === 'VIEW'">
  </div>

  <div class="mb-3">
    <label for="accountNumber" class="form-label">Account Number</label>
    <input type="text" class="form-control disabled-bg" id="accountNumber"
      [(ngModel)]="bankModal.bankDetails.bankAccountNumber" name="accountNumber" placeholder="Enter Account Number"
      [disabled]="modal.action === 'VIEW'">
  </div>

  <!--Isce Code-->
  <div class="mb-3">
    <label for="accountNumber" class="form-label">IFSC Code</label>
    <input type="text" class="form-control disabled-bg" id="accountNumber" [(ngModel)]="bankModal.bankDetails.isceCode"
      name="accountNumber" placeholder="Enter IFSC Code" [disabled]="modal.action === 'VIEW'">
  </div>

  <!--pfNumber-->
  <div class="mb-3">
    <label for="accountNumber" class="form-label">Pf Number</label>
    <input type="text" class="form-control disabled-bg" id="accountNumber" [(ngModel)]="bankModal.bankDetails.pfNumber"
      name="accountNumber" placeholder="Enter PF Number" [disabled]="modal.action === 'VIEW'">
  </div>


  <!--esicNumber-->
  <div class="mb-3">
    <label for="accountNumber" class="form-label">Esic Number</label>
    <input type="text" class="form-control disabled-bg" id="accountNumber"
      [(ngModel)]="bankModal.bankDetails.esicNumber" name="accountNumber" placeholder="Enter ESIC Number"
      [disabled]="modal.action === 'VIEW'">
  </div>

  <!--pfScheme-->
  <div class="mb-3">
    <label for="accountNumber" class="form-label">PF Scheme</label>
    <input type="text" class="form-control disabled-bg" id="accountNumber" [(ngModel)]="bankModal.bankDetails.pfScheme"
      name="accountNumber" placeholder="Enter PF Scheme" [disabled]="modal.action === 'VIEW'">
  </div>

  <!--paymentType-->
  <div class="mb-3">
    <label for="accountNumber" class="form-label">Payment Type</label>
    <input type="text" class="form-control disabled-bg" id="accountNumber"
      [(ngModel)]="bankModal.bankDetails.paymentType" name="accountNumber" placeholder="Enter Payment Type"
      [disabled]="modal.action === 'VIEW'">
  </div>

  <!--UAN number-->
  <div class="mb-3">
    <label for="uanNumber" class="form-label">UAN Number</label>
    <input type="text" class="form-control disabled-bg" id="accountNumber"
      [(ngModel)]="bankModal.bankDetails.uanNumber" name="uanNumber" placeholder="Enter UAN"
      [disabled]="modal.action === 'VIEW'">
  </div>

</app-common-dialog>